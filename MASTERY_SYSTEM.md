# Adaptive Mastery System Design (μ μ‘ν• λ§μ¤ν„°λ¦¬ ν•™μµ μ‹μ¤ν…)

> μ΄ λ¬Έμ„λ” λ§μ¤ν„°λ¦¬ ν•™μµ μ‹μ¤ν…μ μµμΆ… μ„¤κ³„ μ‚¬μ–‘μ…λ‹λ‹¤.
> λ¨λ“  κµ¬ν„μ€ μ΄ λ¬Έμ„λ¥Ό κΈ°μ¤€μΌλ΅ ν•©λ‹λ‹¤.

---

## 1. ν•µμ‹¬ μ›μΉ™

- **μ¤ν…μ΄μ§€ κµ¬λ¶„ μ—†μ**: μ‚¬μ©μμ—κ² Stage 1, 2, 3 κ°™μ€ κµ¬λ¶„μ„ λ³΄μ—¬μ£Όμ§€ μ•μ
- **50λ¬Έν•­ λ‹¨μΌ ν”λ΅μ°**: ν• μ„Έμ…μ— 50λ¬Έν•­μ„ ν•λ²μ— μ§„ν–‰ (μ¤‘κ°„ μ „ν™ ν™”λ©΄ μ—†μ)
- **μ‹¤μ‹κ°„ XP κΈ°λ° λ λ²¨ μ§„ν–‰**: λ§¤ λ¬Έν•­ μ •λ‹µ/μ¤λ‹µλ§λ‹¤ XPκ°€ μ‹¤μ‹κ°„ λ³€λ™, λ λ²¨μ΄ μ¦‰μ‹ λ°”λ€
- **RPG κ²μ„ λ°©μ‹**: "λ λ²¨1 λ¬μ¤ν„°λ¥Ό μ΅μ•„ κ²½ν—μΉ νλ“ β†’ λ λ²¨μ—… β†’ λ λ²¨2 λ¬μ¤ν„° λ„μ „"
- **λ¬Έμ  μ ν• μλ™ νΌν•©**: λ‹¨μ–΄β†’λ», λ»β†’λ‹¨μ–΄, λ“£κΈ°, νƒ€μ΄ν•‘ λ“±μ΄ ν• μ„Έμ…μ— μ„μ—¬μ„ μ¶μ 
- **λ¬Έμ  ν’€ λ°©μ‹**: μ—¬λ¬ λ λ²¨μ λ¬Έμ λ¥Ό λ―Έλ¦¬ λ΅λ“, ν„μ¬ λ λ²¨ ν’€μ—μ„ μ¶μ , λ λ²¨ λ³€κ²½ μ‹ μ¦‰μ‹ μ „ν™

---

## 2. XP κΈ°λ° λ λ²¨ μ‹μ¤ν… (ν•µμ‹¬)

### 2.1 λ λ²¨ κµ¬μ΅°
- 15κ° λ λ²¨ (κµμ¬ 1κ¶~15κ¶ = Level 1~15)
- κ° λ λ²¨μ€ μ—¬λ¬ LessonμΌλ΅ κµ¬μ„±
- μ„λΈλ λ²¨: "1-1" ν•μ‹ (κµμ¬λ²νΈ-λ μ¨λ²νΈ)
- λ λ²¨ β†’ λ­ν¬ λ§¤ν•‘: Level 1=Iron, 2=Bronze, 3=Silver, 4=Gold, ... 10=Challenger

### 2.2 XP λ©”μΉ΄λ‹‰μ¤ (RPG λ°©μ‹)

#### κΈ°λ³Έ XP νλ“/μ°¨κ°
| μƒν™© | XP λ³€λ™ | μ„¤λ… |
|---|---|---|
| ν„μ¬ λ λ²¨ λ¬Έμ  μ •λ‹µ | +7 XP | κΈ°λ³Έ νλ“ |
| ν„μ¬ λ λ²¨ λ¬Έμ  μ •λ‹µ + λΉ λ¥Έ ν’€μ΄ | +12 XP | μ†λ„ λ³΄λ„μ¤ (+5) |
| λ‚®μ€ λ λ²¨ λ¬Έμ  μ •λ‹µ | +3 XP | μ‰¬μ΄ λ¬μ¤ν„°λ” κ²½ν—μΉ μ μ |
| μ¤λ‹µ | -5 XP | κΈ°λ³Έ ν¨λ„ν‹° |
| μ—°μ† 2ν μ¤λ‹µ | -8 XP | 2μ—°μ† ν¨λ„ν‹° κ°•ν™” |
| μ—°μ† 3ν+ μ¤λ‹µ | -12 XP | 3μ—°μ† μ΄μƒ ν¨λ„ν‹° λ” κ°•ν™” |

#### μ½¤λ³΄ λ³΄λ„μ¤ (μ—°μ† μ •λ‹µ)
| μ½¤λ³΄ | μ¶”κ°€ XP |
|---|---|
| 3~4μ½¤λ³΄ | +1 XP |
| 5~9μ½¤λ³΄ | +2 XP |
| 10~14μ½¤λ³΄ | +3 XP |
| 15~19μ½¤λ³΄ | +4 XP |
| 20μ½¤λ³΄+ | +5 XP |

#### μ†λ„ λ³΄λ„μ¤ νμ •
- μ ν• μ‹κ°„μ 50% μ΄λ‚΄μ— μ •λ‹µ β†’ μ†λ„ λ³΄λ„μ¤ μ μ©
- μ: 5μ΄ μ ν• λ¬Έμ λ¥Ό 2.5μ΄ μ΄λ‚΄μ— μ •λ‹µ β†’ +5 XP μ¶”κ°€

### 2.3 λ λ²¨ κµ¬μ΅°: κµμ¬λ³„ λ μ¨λ³„ XP

κ° κµμ¬λ” 25κ° λ μ¨ Γ— 20λ‹¨μ–΄ = 500λ‹¨μ–΄λ΅ κµ¬μ„±.
λ μ¨λ§λ‹¤ λ λ²¨μ—… κµ¬κ°„μ΄ μμΌλ©°, κµμ¬κ°€ μ¬λΌκ°μλ΅ λ μ¨λ‹Ή ν•„μ” XPκ°€ +5μ”© μ¦κ°€:

| κµμ¬ (Level) | λ μ¨λ‹Ή XP | μ΄ XP (25λ μ¨) | λ„μ  XP |
|---|---|---|---|
| 1κ¶ | 10 XP | 250 | 250 |
| 2κ¶ | 15 XP | 375 | 625 |
| 3κ¶ | 20 XP | 500 | 1,125 |
| 4κ¶ | 25 XP | 625 | 1,750 |
| 5κ¶ | 30 XP | 750 | 2,500 |
| 6κ¶ | 35 XP | 875 | 3,375 |
| 7κ¶ | 40 XP | 1,000 | 4,375 |
| 8κ¶ | 45 XP | 1,125 | 5,500 |
| 9κ¶ | 50 XP | 1,250 | 6,750 |
| 10κ¶ | 55 XP | 1,375 | 8,125 |

```typescript
function getLessonXp(book: number): number {
  return 5 + book * 5;  // Book 1: 10, Book 2: 15, ..., Book 10: 55
}
```

#### μ„λΈλ λ²¨ ν‘μ‹
- ν„μ¬ λ λ²¨: "κµμ¬-λ μ¨" ν•μ‹ (μ: "1-1", "2-15", "5-23")
- λ μ¨ μ§„ν–‰: XP λ„μ  β†’ λ μ¨ ν΄λ¦¬μ–΄ β†’ λ‹¤μ λ μ¨
- κµμ¬ μ§„ν–‰: 25λ μ¨ λ¨λ‘ ν΄λ¦¬μ–΄ β†’ λ‹¤μ κµμ¬

#### λ λ²¨μ—… μ΅°κ±΄
- ν•΄λ‹Ή λ μ¨μ λ„μ  XPκ°€ λ μ¨λ‹Ή XPμ— λ„λ‹¬ β†’ λ‹¤μ λ μ¨μΌλ΅ μ§„ν–‰
- μ΄κ³Ό XPλ” λ‹¤μ λ μ¨μΌλ΅ μ΄μ›”
- 25λ μ¨ λ¨λ‘ ν΄λ¦¬μ–΄ μ‹ β†’ λ‹¤μ κµμ¬ 1λ μ¨μΌλ΅ μ§„ν–‰
- μ¦‰μ‹ ν•΄λ‹Ή λ λ²¨μ λ¬Έμ  ν’€λ΅ μ „ν™

#### λ λ²¨λ‹¤μ΄ μ΅°κ±΄
- XPκ°€ 0 λ―Έλ§μΌλ΅ λ–¨μ–΄μ§€λ©΄ β†’ μ΄μ „ λ μ¨μΌλ΅ κ°•λ“±
- 1λ μ¨μ—μ„ 0 λ―Έλ§ β†’ μ΄μ „ κµμ¬ 25λ μ¨μΌλ΅ κ°•λ“±
- μ΄μ „ λ μ¨μ—μ„ ν•΄λ‹Ή λ μ¨ XPμ 80% μ§€μ μ—μ„ μ‹μ‘
- μ—°μ† μ¤λ‹µ ν¨λ„ν‹° λ„μ μΌλ΅ λΉ λ¥΄κ² λ λ²¨λ‹¤μ΄ κ°€λ¥

### 2.4 "μ²μ¬ ν…μ¤νΈ" μ‹λ‚λ¦¬μ¤
50λ¬Έν•­ μ „λ¶€ μ •λ‹µ + λΉ λ¥Έ ν’€μ΄ (ν‰κ·  ~13 XP/λ¬Έν•­, μ½¤λ³΄ ν¬ν•¨):
```
λ¬Έν•­ 1~19: 1κ¶ ν΄λ¦¬μ–΄ (250 XP Γ· ~13 = ~19λ¬Έν•­)
λ¬Έν•­ 20~47: 2κ¶ ν΄λ¦¬μ–΄ (375 XP Γ· ~14 = ~27λ¬Έν•­, μ½¤λ³΄ μ„±μ¥)
λ¬Έν•­ 48~50: 3κ¶ μ‹μ‘ (~42 XP = 2λ μ¨)
β†’ μµμΆ… λ λ²¨: 3-2 (3κ¶ 2λ μ¨)
```
- μ²μ¬ ν•™μƒ: Level 3 λ„λ‹¬
- μ°μ ν•™μƒ: Level 2 λ„λ‹¬
- λ³΄ν†µ ν•™μƒ: Level 1-15~1-25 λ²”μ„
- λ¶€μ§„ ν•™μƒ: Level 1-5 μ΄ν• (μ¤λ‹µ ν¨λ„ν‹°λ΅ μ§„ν–‰ λλ¦Ό)

---

## 3. λ¬Έμ  ν’€(Pool) μ‹μ¤ν…

### 3.1 μ΄κΈ° λ΅λ“
μ„Έμ… μ‹μ‘ μ‹ μ„λ²„μ—μ„ **λ©€ν‹° λ λ²¨ λ¬Έμ  ν’€**μ„ ν•λ²μ— λ΅λ“:
```
ν„μ¬ λ λ²¨λ¶€ν„° +4λ λ²¨κΉμ§€, κ° λ λ²¨λ‹Ή 10λ¬Έν•­ = μµλ€ 50λ¬Έν•­
μ: current_level=1μ΄λ©΄ β†’ L1(10) + L2(10) + L3(10) + L4(10) + L5(10)
```

### 3.2 ν”„λ΅ νΈμ—”λ“ ν’€ κ΄€λ¦¬
```typescript
// λ λ²¨λ³„ λ¬Έμ  ν’€
levelPools: Record<number, MasteryQuestion[]>
// {1: [...10λ¬Έν•­], 2: [...10λ¬Έν•­], 3: [...10λ¬Έν•­], ...}
```

- **ν„μ¬ λ λ²¨**μ ν’€μ—μ„ μμ„λ€λ΅ μ¶μ 
- λ λ²¨ λ³€κ²½ μ‹ β†’ ν•΄λ‹Ή λ λ²¨μ ν’€λ΅ μ¦‰μ‹ μ „ν™
- ν’€μ΄ μ†μ§„λλ©΄ β†’ μ„λ²„μ—μ„ ν•΄λ‹Ή λ λ²¨μ μ¶”κ°€ λ¬Έν•­ lazy fetch

### 3.3 λ λ²¨ μ „ν™ μ‹ ν’€ λ™μ‘
```
[λ λ²¨μ—… μ‹]
ν„μ¬: L1 ν’€μ—μ„ μ¶μ  μ¤‘ β†’ XP λ‹¬μ„± β†’ λ λ²¨ 2λ΅ μ—…
λ‹¤μ λ¬Έν•­: L2 ν’€μ—μ„ μ¶μ  (μ΄λ―Έ λ΅λ“λ¨, μ¦‰μ‹ μ „ν™)

[λ λ²¨λ‹¤μ΄ μ‹]
ν„μ¬: L2 ν’€μ—μ„ μ¶μ  μ¤‘ β†’ XP 0 μ΄ν• β†’ λ λ²¨ 1λ΅ λ‹¤μ΄
λ‹¤μ λ¬Έν•­: L1 ν’€μ—μ„ μ¶μ  (μ΄λ―Έ λ΅λ“λ¨, μ¦‰μ‹ μ „ν™)
```

### 3.4 Lazy Loading (ν’€ μ†μ§„ μ‹)
```
L1 ν’€ 10λ¬Έν•­ λ¨λ‘ μ‚¬μ© β†’ μ„λ²„μ— μ”μ²­: POST /mastery/batch {session_id, level: 1, batch_size: 10}
β†’ L1 μ¶”κ°€ 10λ¬Έν•­ λ΅λ“ β†’ L1 ν’€μ— μ¶”κ°€
```

### 3.5 λ°±μ—”λ“ API
| μ—”λ“ν¬μΈνΈ | μ©λ„ |
|---|---|
| `POST /mastery/start-by-code` | μ„Έμ… μ‹μ‘ + λ©€ν‹°λ λ²¨ ν’€ λ°ν™ |
| `POST /mastery/batch` | νΉμ • λ λ²¨μ μ¶”κ°€ λ¬Έν•­ μ”μ²­ (lazy loading) |
| `POST /mastery/{session_id}/answer` | λ‹µμ• μ μ¶ + λ‚΄λ¶€ λ§μ¤ν„°λ¦¬ μ²λ¦¬ |
| `POST /mastery/complete-batch` | 50λ¬Έν•­ μ™„λ£, `final_level` μ €μ¥ |

---

## 4. λ¬Έμ  μ¶μ  λ°©μ‹

### 4.1 λ¬Έμ  μ ν• μλ™ κ²°μ •
κ° λ‹¨μ–΄μ **λ‚΄λ¶€ λ§μ¤ν„°λ¦¬ μ¤ν…μ΄μ§€**(μ‚¬μ©μμ—κ² λΉ„κ³µκ°)μ— λ”°λΌ λ¬Έμ  μ ν• κ²°μ •:

| λ‚΄λ¶€ μ¤ν…μ΄μ§€ | λ¬Έμ  μ ν• | μ„¤λ… |
|---|---|---|
| 1 (μƒ λ‹¨μ–΄) | λ‹¨μ–΄β†’λ» μ„ νƒ / λ»β†’λ‹¨μ–΄ μ„ νƒ (50:50 λλ¤) | κ°€μ¥ μ‰¬μ›€, 5μ΄ |
| 2 | λ»β†’λ‹¨μ–΄ μ„ νƒ / λ‹¨μ–΄β†’λ» μ„ νƒ (50:50 λλ¤) | μ‰¬μ›€, 5μ΄ |
| 3 | λ“£κ³  νƒ€μ΄ν•‘ | μ¤‘κ°„, 15μ΄ |
| 4 | λ“£κ³  λ» μ„ νƒ | μ¤‘μƒ, 10μ΄ |
| 5 | λ» λ³΄κ³  νƒ€μ΄ν•‘ | μ–΄λ ¤μ›€, 15μ΄ |

### 4.2 μλ¬Έ μ¶μ  ν™•λ¥  (λ λ²¨λ³„)
- Level 1-3: 0% (λ‹¨μ–΄λ§)
- Level 4-5: 20%
- Level 6-7: 40%
- Level 8-9: 60%
- Level 10-12: 80%
- Level 13-15: 100% (ν•­μƒ μλ¬Έ)

### 4.3 λ‹¨μ–΄ λ§μ¤ν„°λ¦¬ μ§„ν–‰ (λ‚΄λ¶€, λΉ„κ³µκ°)
- κ° λ‹¨μ–΄λ” μ¤ν…μ΄μ§€ 1~5λ¥Ό κ±°μ³ "λ§μ¤ν„°" μƒνƒμ— λ„λ‹¬
- μ—°μ† μ •λ‹µ νμ(streak)μ— λ”°λΌ λ‹¤μ μ¤ν…μ΄μ§€λ΅ μΉκΈ‰:
  - Level 1-3 λ‹¨μ–΄: μ—°μ† 2ν μ •λ‹µ β†’ μΉκΈ‰
  - Level 4-6: 3ν
  - Level 7-9: 4ν
  - Level 10-12: 5ν
  - Level 13-15: 6ν
- μ¤λ‹µ μ‹: μ΄μ „ μ¤ν…μ΄μ§€λ΅ κ°•λ“± + streak λ¦¬μ…‹
- μ¤ν…μ΄μ§€ 5 ν†µκ³Ό β†’ λ§μ¤ν„° μ™„λ£ (SRS λ³µμµ μ¤μΌ€μ¤„ μ„¤μ •)

---

## 5. ν”„λ΅ νΈμ—”λ“ μ•„ν‚¤ν…μ²

### 5.1 masteryStore (Zustand)
```typescript
interface MasteryStore {
  // μ„Έμ…
  session: MasterySessionInfo | null;
  totalWords: number;

  // λ¬Έμ  ν’€
  levelPools: Record<number, MasteryQuestion[]>;  // κµμ¬(level)λ³„ λ¬Έμ  ν’€
  poolIndex: Record<number, number>;               // κµμ¬λ³„ ν„μ¬ μΈλ±μ¤

  // XP μ‹μ¤ν…
  xp: number;                    // ν„μ¬ λ μ¨ λ„μ  XP
  currentBook: number;           // ν„μ¬ κµμ¬ (1-10)
  currentLesson: number;         // ν„μ¬ λ μ¨ (1-25)
  displayRank: number;           // ν‘μ‹μ© λ­ν¬ (1-10, = currentBook)

  // μ§„ν–‰
  globalIndex: number;           // μ „μ²΄ λ¬Έν•­ λ²νΈ (0-49)
  combo: number;                 // μ—°μ† μ •λ‹µ
  bestCombo: number;             // μµκ³  μ½¤λ³΄
  correctCount: number;          // μ΄ μ •λ‹µ μ
  totalAnswered: number;         // μ΄ λ‹µλ³€ μ
  consecutiveWrong: number;      // μ—°μ† μ¤λ‹µ (ν¨λ„ν‹° κ³„μ‚°μ©)

  // UI
  selectedAnswer: string | null;
  typedAnswer: string;
  answerResult: MasteryAnswerResult | null;
  isLoading: boolean;
  isSubmitting: boolean;
  isComplete: boolean;           // 50λ¬Έν•­ μ™„λ£
  finalResult: CompleteBatchResponse | null;
}
```

### 5.2 XP κ³„μ‚° ν•¨μ (ν”„λ΅ νΈμ—”λ“)
```typescript
function computeXpChange(params: {
  isCorrect: boolean;
  questionLevel: number;  // λ¬Έμ κ°€ μ†ν• κµμ¬ λ λ²¨
  currentLevel: number;   // ν„μ¬ ν•™μƒμ κµμ¬ λ λ²¨
  timeTaken: number;
  timerLimit: number;
  combo: number;
  consecutiveWrong: number;
}): number {
  if (isCorrect) {
    let xp = questionLevel < currentLevel ? 3 : 7;   // λ‚®μ€ λ λ²¨μ€ +3, ν„μ¬ λ λ²¨ +7
    if (timeTaken <= timerLimit * 0.5) xp += 5;       // μ†λ„ λ³΄λ„μ¤
    if (combo >= 3) xp += Math.min(Math.floor(combo / 5) + 1, 5); // μ½¤λ³΄
    return xp;
  } else {
    // μ—°μ† μ¤λ‹µ μ—μ¤μ»¬λ μ΄ν… ν¨λ„ν‹°
    if (consecutiveWrong >= 2) return -12;
    if (consecutiveWrong >= 1) return -8;
    return -5;
  }
}
```

### 5.3 λ μ¨λ‹Ή XP κ³„μ‚°
```typescript
/** κµμ¬(book)λ³„ λ μ¨ ν•λ‚λ¥Ό ν΄λ¦¬μ–΄ν•λ”λ° ν•„μ”ν• XP */
function getLessonXp(book: number): number {
  return 5 + book * 5;  // Book 1: 10, Book 2: 15, ..., Book 10: 55
}
```

### 5.4 MasteryPage λ λ”λ§
- `question_type` ν•„λ“ κΈ°λ° λ λ”λ§ (μ¤ν…μ΄μ§€ λ²νΈκ°€ μ•„λ‹)
- `word_to_meaning` β†’ WordCard + 4μ§€μ„ λ‹¤ (ν•κµ­μ–΄)
- `meaning_to_word` β†’ MeaningCard + 4μ§€μ„ λ‹¤ (μμ–΄)
- `listen_and_type` β†’ ListenCard + νƒ€μ΄ν•‘ μ…λ ¥
- `listen_to_meaning` β†’ ListenCard + 4μ§€μ„ λ‹¤ (ν•κµ­μ–΄)
- `meaning_and_type` β†’ MeaningCard + νƒ€μ΄ν•‘ μ…λ ¥

### 5.5 MasteryHeader
- λ­ν¬ λ±ƒμ§€ (Iron~Challenger κ·ΈλΌλ””μ–ΈνΈ)
- XP ν”„λ΅κ·Έλ μ¤ λ°” (ν„μ¬ XP / λ λ²¨μ—… ν•„μ” XP)
- μ½¤λ³΄ μΉ΄μ΄ν„°
- μ§„ν–‰ μΉ΄μ΄ν„° (1/50 ~ 50/50)
- λ λ²¨ λ³€κ²½ μ‹ μ• λ‹λ©”μ΄μ… (β–²β–Ό ν”λ΅ν…, ping ring, shake)

---

## 6. UI/UX μ‚¬μ–‘

### 6.1 μ§„ν–‰ λ°”
- λ‹¨μΌ κ·ΈλΌλ””μ–ΈνΈ ν”„λ΅κ·Έλ μ¤ λ°” (μΈλ””κ³ β†’λ³΄λΌ)
- 1/50λ¶€ν„° 50/50κΉμ§€ μ μ§„μ  μ¦κ°€

### 6.2 νƒ€μ΄λ¨Έ
- λ¬Έμ  μ ν•λ³„ νƒ€μ΄λ¨Έ (μ„ νƒν• 5μ΄, λ“£κΈ° 10-15μ΄, νƒ€μ΄ν•‘ 15μ΄)
- μ •λ‹µ ν›„ νƒ€μ΄λ¨Έ μ¨κΉ€
- κ²½κ³ μ: λ‚¨μ€ μ‹κ°„μ— λΉ„λ΅€ν•μ—¬ μ¬μƒ

### 6.3 ν”Όλ“λ°±
- μ •λ‹µ: μ΄λ΅μƒ‰ λ°°λ„ + correct.mp3 (0.8μ΄ ν›„ λ‹¤μ λ¬Έμ )
- μ¤λ‹µ: λΉ¨κ°„μƒ‰ λ°°λ„ + μ •λ‹µ ν‘μ‹ + wrong.mp3 (1.8μ΄ ν›„ λ‹¤μ λ¬Έμ )
- κ±°μ λ§μ (edit_distance=1): λ…Έλ€μƒ‰ "κ±°μ λ§μ•μ–΄μ”!" λ°°λ„
- XP λ³€λ™ ν‘μ‹: "+15 XP" λλ” "-5 XP" ν”λ΅ν… ν…μ¤νΈ

### 6.4 μ¤ν…μ΄μ§€ μ „ν™ ν™”λ©΄
- **μ—†μ** (μ κ±°λ¨)
- 50λ¬Έν•­ μ™„λ£ ν›„ β†’ κ²°κ³Ό ν™”λ©΄

---

## 7. λ°μ΄ν„° λ¨λΈ

### 7.1 LearningSession
- `current_level`: INTEGER, default=1 (μ μ‘ν• λ λ²¨, XP κΈ°λ° μ‹¤μ‹κ°„ λ³€λ™)
- `current_stage`: κΈ°μ΅΄ ν•„λ“ μ μ§€ (ν•μ„νΈν™), λ” μ΄μƒ ν”„λ΅ νΈμ—μ„ μ‚¬μ©ν•μ§€ μ•μ

### 7.2 WordMastery (λ³€κ²½ μ—†μ)
- `stage`: 1-5 (λ‚΄λ¶€ λ§μ¤ν„°λ¦¬ μ¤ν…μ΄μ§€, UI λΉ„κ³µκ°)
- `stage_streak`: μ—°μ† μ •λ‹µ νμ
- `mastered_at`: λ§μ¤ν„° μ™„λ£ μ‹μ 

### 7.3 TestConfig (λ³€κ²½ μ—†μ)
- `level_range_min/max`: μ¶μ  λ²”μ„
- `question_count`: λ°°μΉλ‹Ή λ¬Έν•­ μ (50μΌλ΅ μ„¤μ •)

---

## 8. API μ‘λ‹µ ν•μ‹

### 8.1 StartMasteryResponse (μ„Έμ… μ‹μ‘ + λ©€ν‹°λ λ²¨ ν’€)
```json
{
  "session": { "id": "...", "current_stage": 1, "words_practiced": 0, ... },
  "questions": [/* L1 10λ¬Έν•­ + L2 10λ¬Έν•­ + L3 10λ¬Έν•­ + ... */],
  "total_words": 500,
  "current_level": 1,
  "access_token": "jwt...",
  "student_name": "κΉ€μ² μ"
}
```

### 8.2 MasteryBatchResponse (lazy loading)
```json
{
  "questions": [/* ν•΄λ‹Ή λ λ²¨ 10λ¬Έν•­ */],
  "current_level": 3,
  "remaining_in_stage": 0,
  "stage_summary": { ... }
}
```

### 8.3 MasteryAnswerResult (λ‹µμ• μ μ¶)
```json
{
  "is_correct": true,
  "almost_correct": false,
  "correct_answer": "apple",
  "new_stage": 2,
  "previous_stage": 1,
  "word_mastered": false,
  "stage_streak": 1,
  "required_streak": 2,
  "current_level": 1
}
```

### 8.4 CompleteBatchResponse (50λ¬Έν•­ μ™„λ£)
```json
{
  "current_level": 3,
  "previous_level": 1,
  "level_changed": true,
  "accuracy": 85.0
}
```

---

## 9. μ‹¤μ‹κ°„ λ λ²¨ νλ¦„ μμ‹

```
ν„μ¬: Level 1-1 (1κ¶ Lesson 01), XP: 0/10

λ¬Έν•­ 1: 1κ¶L01 "apple" β†’ μ •λ‹µ (2.1μ΄) β†’ +12 XP (κΈ°λ³Έ7 + μ†λ„5)
β†’ XP: 12 β†’ 10 ν΄λ¦¬μ–΄! β†’ Level 1-2, μ”μ—¬ XP: 2/10

λ¬Έν•­ 2: 1κ¶L02 "book" β†’ μ •λ‹µ (1.8μ΄) β†’ +12 XP
β†’ XP: 14 β†’ 10 ν΄λ¦¬μ–΄! β†’ Level 1-3, μ”μ—¬ XP: 4/10

λ¬Έν•­ 3: 1κ¶L03 "cat" β†’ μ •λ‹µ (2.4μ΄) β†’ +13 XP (κΈ°λ³Έ7 + μ†λ„5 + μ½¤λ³΄1)
β†’ XP: 17 β†’ 10 ν΄λ¦¬μ–΄! β†’ Level 1-4, μ”μ—¬ XP: 7/10

λ¬Έν•­ 4: 1κ¶L04 "dog" β†’ μ •λ‹µ (1.5μ΄) β†’ +13 XP
β†’ XP: 20 β†’ 2λ μ¨ ν΄λ¦¬μ–΄! β†’ Level 1-6, μ”μ—¬ XP: 0/10
(λΉ λ¥Έ λ λ²¨μ—… μ²΄κ°! π‰)

...

λ¬Έν•­ 19: 1κ¶L25 β†’ μ •λ‹µ β†’ 1κ¶ μ „μ²΄ ν΄λ¦¬μ–΄!
β†’ Level 2-1 (2κ¶ Lesson 01), XP: 0/15

λ¬Έν•­ 20: 2κ¶L01 "achieve" β†’ μ •λ‹µ (3.2μ΄) β†’ +8 XP (κΈ°λ³Έ7 + μ½¤λ³΄1, μ†λ„λ³΄λ„μ¤ μ—†μ)
β†’ XP: 8/15

λ¬Έν•­ 21: 2κ¶L01 "benefit" β†’ μ¤λ‹µ β†’ -5 XP β†’ XP: 3/15, μ½¤λ³΄ λ¦¬μ…‹
λ¬Έν•­ 22: 2κ¶L01 "climate" β†’ μ¤λ‹µ β†’ -8 XP (2μ—°μ†) β†’ XP: -5 β†’ π”» LEVEL DOWN!
β†’ Level 1-25 (1κ¶ λ§μ§€λ§‰ λ μ¨), XP: 8/10 (μ΄μ „ λ μ¨ XPμ 80%)

λ¬Έν•­ 23: 1κ¶L25 "zebra" β†’ μ •λ‹µ (2.0μ΄) β†’ +3 XP (λ‚®μ€ λ λ²¨ λ¬Έμ )
β†’ XP: 11 β†’ 10 ν΄λ¦¬μ–΄! β†’ Level 2-1 λ‹¤μ‹! μ”μ—¬ XP: 1/15
...
```

---

## 10. κµ¬ν„ μƒνƒ

### 10.1 λ°±μ—”λ“ (μ™„λ£)
- [x] DB λ§μ΄κ·Έλ μ΄μ…: `learning_sessions.current_level` μ¶”κ°€
- [x] `get_question_pool()`: λ©€ν‹°λ λ²¨ λ¬Έμ  ν’€ μƒμ„±
- [x] `get_level_questions()`: νΉμ • λ λ²¨ λ¬Έν•­ lazy loading
- [x] `submit_answer()`: λ‚΄λ¶€ λ§μ¤ν„°λ¦¬ μ¤ν…μ΄μ§€ μ²λ¦¬
- [x] `complete_batch()`: `final_level` μ €μ¥ + μ„Έμ… μ™„λ£ μ²λ¦¬

### 10.2 ν”„λ΅ νΈμ—”λ“ (μ™„λ£)
- [x] `types/mastery.ts`: QuestionType ν—¬νΌ, CompleteBatchResponse
- [x] `stores/masteryStore.ts`: XP ν’€ μ‹μ¤ν… (levelPools, computeXpChange, λ λ²¨μ—…/λ‹¤μ΄)
- [x] `services/mastery.ts`: μƒ API λ§¤μΉ­ (fetchLevelQuestions, completeBatch)
- [x] `MasteryPage.tsx`: question_type κΈ°λ° λ λ”λ§, XP λ³€λ™ ν‘μ‹
- [x] `MasteryHeader.tsx`: XP ν”„λ΅κ·Έλ μ¤ λ°” + Lv.1-3 λ μ΄λΈ”

---

*Last updated: 2026-02-11*
