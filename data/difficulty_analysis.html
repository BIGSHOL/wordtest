<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Power Voca 5000 ë‚œì´ë„ ë¶„ì„</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
<style>
:root {
  --bg: #0a0e1a;
  --card: #111827;
  --card-hover: #1a2234;
  --border: #1e293b;
  --text: #e2e8f0;
  --text-muted: #94a3b8;
  --text-dim: #64748b;
  --accent1: #3b82f6;
  --accent2: #22d3ee;
  --accent3: #a78bfa;
  --accent4: #f472b6;
  --green: #34d399;
  --yellow: #fbbf24;
  --orange: #fb923c;
  --red: #f87171;
  --beginner: #34d399;
  --intermediate: #3b82f6;
  --upper: #f59e0b;
  --advanced: #ef4444;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Noto Sans KR', sans-serif;
  line-height: 1.6;
  min-height: 100vh;
}

.noise {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.03;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
  position: relative;
  z-index: 1;
}

header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 3rem 0 2rem;
  position: relative;
}

header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--accent2), transparent);
}

h1 {
  font-size: 2.5rem;
  font-weight: 900;
  letter-spacing: -0.02em;
  background: linear-gradient(135deg, var(--accent2), var(--accent1), var(--accent3));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 0.5rem;
}

.subtitle {
  color: var(--text-muted);
  font-size: 1rem;
  font-weight: 300;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.25rem;
  text-align: center;
  transition: all 0.3s;
}

.stat-card:hover {
  background: var(--card-hover);
  transform: translateY(-2px);
  border-color: var(--accent1);
}

.stat-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 2rem;
  font-weight: 600;
  color: var(--accent2);
}

.stat-label {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-top: 0.25rem;
}

.section-title {
  font-size: 1.3rem;
  font-weight: 700;
  margin: 2.5rem 0 1rem;
  padding-left: 0.75rem;
  border-left: 3px solid var(--accent1);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.chart-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.chart-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
}

.chart-card.full {
  grid-column: 1 / -1;
}

.chart-card h3 {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.chart-wrap {
  position: relative;
  height: 320px;
}

.chart-wrap.tall { height: 420px; }

/* Book ranking table */
.rank-table {
  width: 100%;
  border-collapse: collapse;
}

.rank-table th {
  text-align: left;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 0.75rem 0.5rem;
  border-bottom: 1px solid var(--border);
}

.rank-table td {
  padding: 0.6rem 0.5rem;
  font-size: 0.85rem;
  border-bottom: 1px solid rgba(30,41,59,0.5);
  vertical-align: middle;
}

.rank-table tr:hover td {
  background: rgba(59,130,246,0.05);
}

.book-name {
  font-weight: 500;
  max-width: 200px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.difficulty-bar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.bar-track {
  flex: 1;
  height: 8px;
  background: rgba(255,255,255,0.05);
  border-radius: 4px;
  overflow: hidden;
}

.bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 1s ease;
}

.bar-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  font-weight: 600;
  min-width: 36px;
  text-align: right;
}

.grade-badge {
  display: inline-block;
  padding: 0.15rem 0.5rem;
  border-radius: 999px;
  font-size: 0.7rem;
  font-weight: 600;
}

/* Tabs */
.tab-container {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}

.tab-btn {
  background: var(--card);
  border: 1px solid var(--border);
  color: var(--text-muted);
  padding: 0.5rem 1rem;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.8rem;
  font-weight: 500;
  transition: all 0.2s;
}

.tab-btn:hover {
  border-color: var(--accent1);
  color: var(--text);
}

.tab-btn.active {
  background: var(--accent1);
  border-color: var(--accent1);
  color: white;
}

.lesson-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 0.5rem;
}

.lesson-cell {
  aspect-ratio: 1;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 500;
  cursor: default;
  transition: transform 0.2s;
  border: 1px solid transparent;
}

.lesson-cell:hover {
  transform: scale(1.08);
  border-color: rgba(255,255,255,0.2);
  z-index: 2;
}

.lesson-cell .lesson-num {
  font-size: 0.65rem;
  opacity: 0.7;
  margin-bottom: 2px;
}

.lesson-cell .lesson-score {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1rem;
  font-weight: 600;
}

.legend {
  display: flex;
  gap: 1.5rem;
  justify-content: center;
  margin: 1rem 0;
  flex-wrap: wrap;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

.tooltip-box {
  display: none;
  position: fixed;
  z-index: 100;
  background: #1e293b;
  border: 1px solid var(--accent1);
  border-radius: 8px;
  padding: 0.75rem;
  font-size: 0.8rem;
  pointer-events: none;
  min-width: 180px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
}

.insight-box {
  background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(34,211,238,0.05));
  border: 1px solid rgba(59,130,246,0.3);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 2rem 0;
}

.insight-box h3 {
  color: var(--accent2);
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.insight-box p {
  color: var(--text-muted);
  font-size: 0.9rem;
  line-height: 1.8;
}

.series-label {
  display: inline-block;
  padding: 0.2rem 0.6rem;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 600;
  margin-right: 0.25rem;
}

.series-basic { background: rgba(59,130,246,0.2); color: var(--accent1); }
.series-suneung { background: rgba(167,139,250,0.2); color: var(--accent3); }

@media (max-width: 768px) {
  .stats-row { grid-template-columns: repeat(2, 1fr); }
  .chart-grid { grid-template-columns: 1fr; }
  h1 { font-size: 1.8rem; }
  .container { padding: 1rem; }
}
</style>
</head>
<body>
<div class="noise"></div>
<div class="container">
  <header>
    <h1>Power Voca 5000 ë‚œì´ë„ ë¶„ì„</h1>
    <p class="subtitle">15ê°œ êµì¬, 400ê°œ ë ˆìŠ¨, 11,132ê°œ ì˜ë‹¨ì–´ì˜ ë‚œì´ë„ ì‹¬ì¸µ ë¶„ì„</p>
  </header>

  <div class="stats-row" id="statsRow"></div>

  <section class="section-title">ğŸ“Š êµì¬ë³„ ë‚œì´ë„ ìˆœìœ„</section>
  <div class="chart-card">
    <table class="rank-table" id="rankTable"></table>
  </div>

  <section class="section-title">ğŸ“ˆ ë‚œì´ë„ ì§€í‘œ ë¹„êµ</section>
  <div class="chart-grid">
    <div class="chart-card">
      <h3>êµì¬ë³„ í‰ê·  ë‚œì´ë„ ì ìˆ˜</h3>
      <div class="chart-wrap"><canvas id="chartDifficulty"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>êµì¬ë³„ ë‚œì´ë„ ë“±ê¸‰ ë¶„í¬ (%)</h3>
      <div class="chart-wrap"><canvas id="chartGrades"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>í‰ê·  ë‹¨ì–´ ê¸¸ì´ & ìŒì ˆ ìˆ˜</h3>
      <div class="chart-wrap"><canvas id="chartWordLen"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>ê¸°ì´ˆ ì–´íœ˜ ë¹„ìœ¨ vs íŒŒìƒì–´ ë¹„ìœ¨</h3>
      <div class="chart-wrap"><canvas id="chartRatios"></canvas></div>
    </div>
  </div>

  <div class="insight-box">
    <h3>ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h3>
    <p id="insightText"></p>
  </div>

  <section class="section-title">ğŸ—ºï¸ ë ˆìŠ¨ë³„ ë‚œì´ë„ íˆíŠ¸ë§µ</section>
  <p style="color:var(--text-dim);font-size:0.85rem;margin-bottom:1rem;">êµì¬ë¥¼ ì„ íƒí•˜ë©´ ê° ë ˆìŠ¨ì˜ ë‚œì´ë„ë¥¼ ìƒ‰ìƒìœ¼ë¡œ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  <div class="tab-container" id="bookTabs"></div>
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--beginner)"></div>ì´ˆê¸‰ (&lt;25)</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--intermediate)"></div>ì¤‘ê¸‰ (25-40)</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--upper)"></div>ì¤‘ìƒê¸‰ (40-55)</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--advanced)"></div>ê³ ê¸‰ (55+)</div>
  </div>
  <div id="heatmapContainer"></div>

  <section class="section-title" style="margin-top:3rem;">ğŸ“‹ ì„ íƒ êµì¬ ë ˆìŠ¨ ìƒì„¸</section>
  <div class="chart-card">
    <h3 id="lessonChartTitle">êµì¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
    <div class="chart-wrap tall"><canvas id="chartLessons"></canvas></div>
  </div>
</div>

<div class="tooltip-box" id="tooltip"></div>

<script>
const DATA = {
  books: [
    {name:"Power Voca 5000-01",avgDifficulty:26.6,avgWordLen:4.8,avgSyllables:1.4,basicRatio:57.1,morphComplex:8.6,wordCount:499},
    {name:"Power Voca 5000-02",avgDifficulty:31.5,avgWordLen:5.5,avgSyllables:1.6,basicRatio:47.2,morphComplex:12.6,wordCount:500},
    {name:"Power Voca 5000-03",avgDifficulty:37.4,avgWordLen:6.6,avgSyllables:2.0,basicRatio:42.8,morphComplex:23.0,wordCount:500},
    {name:"Power Voca 5000-04",avgDifficulty:44.6,avgWordLen:7.5,avgSyllables:2.2,basicRatio:28.0,morphComplex:30.2,wordCount:500},
    {name:"Power Voca 5000-05",avgDifficulty:47.1,avgWordLen:8.0,avgSyllables:2.4,basicRatio:23.0,morphComplex:28.0,wordCount:500},
    {name:"Power Voca 5000-06",avgDifficulty:47.8,avgWordLen:8.2,avgSyllables:2.5,basicRatio:23.0,morphComplex:27.4,wordCount:500},
    {name:"Power Voca 5000-07",avgDifficulty:44.6,avgWordLen:7.7,avgSyllables:2.3,basicRatio:27.2,morphComplex:23.4,wordCount:500},
    {name:"Power Voca 5000-08",avgDifficulty:53.7,avgWordLen:8.7,avgSyllables:2.7,basicRatio:11.4,morphComplex:36.4,wordCount:500},
    {name:"Power Voca 5000-09",avgDifficulty:49.7,avgWordLen:8.1,avgSyllables:2.5,basicRatio:16.4,morphComplex:31.8,wordCount:500},
    {name:"Power Voca 5000-10",avgDifficulty:53.2,avgWordLen:8.6,avgSyllables:2.6,basicRatio:10.2,morphComplex:34.2,wordCount:500},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-01",avgDifficulty:46.7,avgWordLen:7.7,avgSyllables:2.4,basicRatio:29.8,morphComplex:43.2,wordCount:1293},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-02",avgDifficulty:51.9,avgWordLen:7.9,avgSyllables:2.5,basicRatio:9.9,morphComplex:40.0,wordCount:1210},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-03",avgDifficulty:55.2,avgWordLen:8.2,avgSyllables:2.6,basicRatio:1.6,morphComplex:40.2,wordCount:1217},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-04",avgDifficulty:53.8,avgWordLen:8.0,avgSyllables:2.5,basicRatio:0.2,morphComplex:31.6,wordCount:1218},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-05",avgDifficulty:54.6,avgWordLen:8.3,avgSyllables:2.6,basicRatio:0.5,morphComplex:31.7,wordCount:1195}
  ],
  grades: [
    {name:"Power Voca 5000-01",beginner:42.1,intermediate:37.1,upperIntermediate:16.4,advanced:4.4},
    {name:"Power Voca 5000-02",beginner:25.6,intermediate:38.6,upperIntermediate:26.4,advanced:9.4},
    {name:"Power Voca 5000-03",beginner:16.4,intermediate:28.8,upperIntermediate:33.6,advanced:21.2},
    {name:"Power Voca 5000-04",beginner:5.8,intermediate:18.8,upperIntermediate:37.4,advanced:38.0},
    {name:"Power Voca 5000-05",beginner:4.8,intermediate:14.0,upperIntermediate:34.4,advanced:46.8},
    {name:"Power Voca 5000-06",beginner:4.0,intermediate:12.4,upperIntermediate:33.4,advanced:50.2},
    {name:"Power Voca 5000-07",beginner:6.2,intermediate:18.8,upperIntermediate:36.8,advanced:38.2},
    {name:"Power Voca 5000-08",beginner:1.4,intermediate:6.6,upperIntermediate:26.4,advanced:65.6},
    {name:"Power Voca 5000-09",beginner:2.6,intermediate:12.0,upperIntermediate:32.2,advanced:53.2},
    {name:"Power Voca 5000-10",beginner:1.4,intermediate:6.6,upperIntermediate:28.0,advanced:64.0},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-01",beginner:7.0,intermediate:20.6,upperIntermediate:33.6,advanced:38.8},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-02",beginner:1.7,intermediate:10.7,upperIntermediate:31.9,advanced:55.7},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-03",beginner:0.5,intermediate:4.7,upperIntermediate:27.9,advanced:66.9},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-04",beginner:0.7,intermediate:5.7,upperIntermediate:33.3,advanced:60.3},
    {name:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-05",beginner:0.3,intermediate:3.8,upperIntermediate:29.5,advanced:66.4}
  ]
};

// Lesson data embedded (key insights per book)
const LESSONS = {};

// We'll generate lesson chart data dynamically
const LESSON_RAW = [
  // Power Voca 5000-01
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-01", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [28.8,26.8,34.6,29.4,26.3,31.8,32.6,26.8,28.7,27.3,20.4,26.3,25.2,19.2,26.2,28.0,31.9,25.8,25.0,30.2,19.9,24.3,25.0,21.1,24.7][i]})),
  // Power Voca 5000-02
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-02", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [27.9,30.6,34.7,38.7,39.3,29.4,30.9,34.8,30.0,29.6,27.7,33.2,28.3,33.7,34.1,33.7,31.2,22.5,28.5,34.3,28.7,30.2,33.7,33.5,28.9][i]})),
  // Power Voca 5000-03
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-03", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [37.6,30.7,32.8,44.5,35.3,38.3,34.6,37.5,44.9,38.4,41.1,35.9,38.2,40.6,35.8,36.7,31.9,41.7,41.3,32.9,30.8,39.4,32.9,41.6,40.5][i]})),
  // Power Voca 5000-04
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-04", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [46.9,43.2,38.9,47.3,37.0,39.4,43.0,45.3,45.8,46.0,47.9,56.8,38.7,45.4,43.4,46.7,39.4,44.5,42.1,41.9,39.7,56.3,50.1,45.7,44.0][i]})),
  // Power Voca 5000-05
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-05", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [41.9,48.0,51.0,41.7,56.5,52.7,45.5,50.7,46.3,46.8,40.0,47.4,45.9,47.1,48.0,53.6,49.2,46.5,51.2,45.4,44.9,42.2,44.6,49.0,41.9][i]})),
  // Power Voca 5000-06
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-06", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [49.0,51.6,50.0,48.3,50.3,51.8,47.5,50.3,40.6,56.5,47.5,47.8,41.8,44.5,48.9,45.7,48.0,42.2,45.8,47.8,45.2,46.7,49.7,45.9,51.4][i]})),
  // Power Voca 5000-07
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-07", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [38.2,39.9,44.3,44.8,46.9,46.3,40.0,47.4,43.9,42.2,54.5,49.2,42.6,42.7,42.8,45.9,46.3,42.8,46.5,41.7,47.6,44.5,42.3,45.1,47.5][i]})),
  // Power Voca 5000-08
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-08", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [53.4,50.8,55.8,52.0,52.0,53.8,54.6,51.7,53.2,55.4,50.3,59.8,58.8,50.3,54.7,58.8,51.8,55.9,57.7,55.3,52.0,51.8,53.8,50.2,49.7][i]})),
  // Power Voca 5000-09
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-09", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [54.5,46.6,52.6,46.9,51.9,46.8,52.3,47.0,54.1,43.4,45.0,42.0,43.7,55.8,51.0,50.3,54.8,46.3,47.7,49.4,49.3,51.3,59.0,48.3,52.8][i]})),
  // Power Voca 5000-10
  ...Array.from({length:25}, (_,i) => ({book:"Power Voca 5000-10", lesson:`Lesson ${String(i+1).padStart(2,'0')}`, avg: [50.8,58.3,54.0,54.3,49.8,57.0,52.8,56.1,53.3,49.2,49.1,54.8,51.6,51.4,52.7,59.0,49.4,51.6,50.1,55.6,52.5,51.7,52.3,55.5,57.1][i]})),
  // ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-01
  ...Array.from({length:30}, (_,i) => ({book:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-01", lesson:`Day ${String(i+1).padStart(2,'0')}`, avg: [44.2,36.8,45.4,45.9,44.3,43.1,39.9,48.3,45.4,43.8,42.7,43.1,50.6,50.5,46.2,42.7,52.3,52.4,48.1,45.5,55.0,55.9,49.6,43.4,44.6,47.5,48.4,47.4,52.1,51.2][i]})),
  // ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-02
  ...Array.from({length:30}, (_,i) => ({book:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-02", lesson:`Day ${String(i+1).padStart(2,'0')}`, avg: [47.4,47.0,49.0,53.1,51.3,53.2,50.7,52.2,54.5,58.8,52.0,43.7,54.6,55.4,49.7,52.6,51.8,48.8,52.4,50.9,56.1,50.7,53.0,53.1,51.6,53.5,54.6,52.8,55.0,51.6][i]})),
  // ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-03
  ...Array.from({length:30}, (_,i) => ({book:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-03", lesson:`DAY ${String(i+1).padStart(2,'0')}`, avg: [56.0,57.5,55.4,53.4,56.1,59.6,53.2,57.4,55.4,58.9,53.7,54.0,57.6,58.1,55.0,56.5,55.4,56.1,54.6,50.7,53.8,54.2,51.5,57.1,53.5,54.4,58.7,53.7,54.2,52.0][i]})),
  // ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-04
  ...Array.from({length:30}, (_,i) => ({book:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-04", lesson:`Day ${String(i+1).padStart(2,'0')}`, avg: [55.1,53.0,57.6,52.0,56.8,53.8,52.5,52.7,51.1,53.9,52.2,53.6,52.3,54.4,51.5,49.9,53.2,57.6,53.8,56.8,54.0,52.4,52.8,54.0,55.1,53.8,54.3,53.7,54.2,56.1][i]})),
  // ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-05
  ...Array.from({length:30}, (_,i) => ({book:"Power Voca ìˆ˜ëŠ¥ ê¸°ì¶œ 5000-05", lesson:`DAY ${String(i+1).padStart(2,'0')}`, avg: [55.1,56.6,57.0,58.2,58.0,54.6,59.3,52.4,52.8,54.4,52.4,55.5,56.5,54.3,51.8,56.0,53.9,57.1,51.1,56.9,57.7,53.7,50.7,54.0,53.3,52.9,54.2,52.7,54.7,52.8][i]})),
];

// Chart.js defaults
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = 'rgba(30,41,59,0.8)';
Chart.defaults.font.family = "'Noto Sans KR', sans-serif";
Chart.defaults.font.size = 11;

function getGradeColor(score) {
  if (score < 25) return 'var(--beginner)';
  if (score < 40) return 'var(--intermediate)';
  if (score < 55) return 'var(--upper)';
  return 'var(--advanced)';
}

function getGradeColorHex(score) {
  if (score < 25) return '#34d399';
  if (score < 40) return '#3b82f6';
  if (score < 55) return '#f59e0b';
  return '#ef4444';
}

function getGradeLabel(score) {
  if (score < 25) return 'ì´ˆê¸‰';
  if (score < 40) return 'ì¤‘ê¸‰';
  if (score < 55) return 'ì¤‘ìƒê¸‰';
  return 'ê³ ê¸‰';
}

function shortName(name) {
  return name.replace('Power Voca ', '').replace('ìˆ˜ëŠ¥ ê¸°ì¶œ ', 'ìˆ˜ëŠ¥');
}

// Render stats
function renderStats() {
  const total = DATA.books.reduce((s,b) => s + b.wordCount, 0);
  const avgDiff = (DATA.books.reduce((s,b) => s + b.avgDifficulty * b.wordCount, 0) / total).toFixed(1);
  const easiest = DATA.books[0];
  const hardest = DATA.books[DATA.books.length - 1];
  
  document.getElementById('statsRow').innerHTML = `
    <div class="stat-card"><div class="stat-value">${total.toLocaleString()}</div><div class="stat-label">ì´ ë‹¨ì–´ ìˆ˜</div></div>
    <div class="stat-card"><div class="stat-value">${avgDiff}</div><div class="stat-label">ì „ì²´ í‰ê·  ë‚œì´ë„</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--green)">${shortName(easiest.name)}</div><div class="stat-label">ê°€ì¥ ì‰¬ìš´ êµì¬ (${easiest.avgDifficulty})</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--red)">${shortName(hardest.name)}</div><div class="stat-label">ê°€ì¥ ì–´ë ¤ìš´ êµì¬ (${hardest.avgDifficulty})</div></div>
  `;
}

// Render rank table
function renderRankTable() {
  const sorted = [...DATA.books].sort((a,b) => a.avgDifficulty - b.avgDifficulty);
  const maxDiff = 70;
  
  let html = `<thead><tr>
    <th style="width:30px">#</th>
    <th>êµì¬ëª…</th>
    <th>ì‹œë¦¬ì¦ˆ</th>
    <th style="width:30%">ë‚œì´ë„</th>
    <th>ì ìˆ˜</th>
    <th>ë“±ê¸‰</th>
    <th>ë‹¨ì–´ ìˆ˜</th>
    <th>ê¸°ì´ˆì–´íœ˜</th>
  </tr></thead><tbody>`;
  
  sorted.forEach((b, i) => {
    const pct = (b.avgDifficulty / maxDiff * 100).toFixed(0);
    const color = getGradeColorHex(b.avgDifficulty);
    const grade = getGradeLabel(b.avgDifficulty);
    const isSuneung = b.name.includes('ìˆ˜ëŠ¥');
    
    html += `<tr>
      <td style="color:var(--text-dim)">${i+1}</td>
      <td class="book-name" title="${b.name}">${shortName(b.name)}</td>
      <td><span class="series-label ${isSuneung ? 'series-suneung' : 'series-basic'}">${isSuneung ? 'ìˆ˜ëŠ¥' : 'ê¸°ë³¸'}</span></td>
      <td><div class="difficulty-bar"><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${color}"></div></div></div></td>
      <td><span class="bar-value" style="color:${color}">${b.avgDifficulty}</span></td>
      <td><span class="grade-badge" style="background:${color}22;color:${color}">${grade}</span></td>
      <td style="font-family:'JetBrains Mono',monospace;font-size:0.8rem">${b.wordCount}</td>
      <td style="font-family:'JetBrains Mono',monospace;font-size:0.8rem">${b.basicRatio}%</td>
    </tr>`;
  });
  
  html += '</tbody>';
  document.getElementById('rankTable').innerHTML = html;
}

// Charts
function renderCharts() {
  const sorted = [...DATA.books].sort((a,b) => a.avgDifficulty - b.avgDifficulty);
  const labels = sorted.map(b => shortName(b.name));
  const colors = sorted.map(b => getGradeColorHex(b.avgDifficulty));
  
  // Difficulty bar chart
  new Chart(document.getElementById('chartDifficulty'), {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        data: sorted.map(b => b.avgDifficulty),
        backgroundColor: colors.map(c => c + '99'),
        borderColor: colors,
        borderWidth: 1,
        borderRadius: 4
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { maxRotation: 45, font: { size: 9 } } },
        y: { beginAtZero: true, max: 70, title: { display: true, text: 'ë‚œì´ë„ ì ìˆ˜' } }
      }
    }
  });
  
  // Grade distribution stacked bar
  const gradesSorted = sorted.map(b => DATA.grades.find(g => g.name === b.name));
  new Chart(document.getElementById('chartGrades'), {
    type: 'bar',
    data: {
      labels,
      datasets: [
        { label: 'ì´ˆê¸‰', data: gradesSorted.map(g => g.beginner), backgroundColor: '#34d39999', borderColor: '#34d399', borderWidth: 1 },
        { label: 'ì¤‘ê¸‰', data: gradesSorted.map(g => g.intermediate), backgroundColor: '#3b82f699', borderColor: '#3b82f6', borderWidth: 1 },
        { label: 'ì¤‘ìƒê¸‰', data: gradesSorted.map(g => g.upperIntermediate), backgroundColor: '#f59e0b99', borderColor: '#f59e0b', borderWidth: 1 },
        { label: 'ê³ ê¸‰', data: gradesSorted.map(g => g.advanced), backgroundColor: '#ef444499', borderColor: '#ef4444', borderWidth: 1 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top', labels: { boxWidth: 12, padding: 8 } } },
      scales: {
        x: { stacked: true, ticks: { maxRotation: 45, font: { size: 9 } } },
        y: { stacked: true, max: 100, title: { display: true, text: '%' } }
      }
    }
  });
  
  // Word length & syllables
  new Chart(document.getElementById('chartWordLen'), {
    type: 'bar',
    data: {
      labels,
      datasets: [
        { label: 'í‰ê·  ê¸€ì ìˆ˜', data: sorted.map(b => b.avgWordLen), backgroundColor: '#3b82f666', borderColor: '#3b82f6', borderWidth: 1, borderRadius: 3 },
        { label: 'í‰ê·  ìŒì ˆ ìˆ˜', data: sorted.map(b => b.avgSyllables), backgroundColor: '#22d3ee66', borderColor: '#22d3ee', borderWidth: 1, borderRadius: 3 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top', labels: { boxWidth: 12, padding: 8 } } },
      scales: {
        x: { ticks: { maxRotation: 45, font: { size: 9 } } },
        y: { beginAtZero: true }
      }
    }
  });
  
  // Basic vs morphological
  new Chart(document.getElementById('chartRatios'), {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'ê¸°ì´ˆ ì–´íœ˜ ë¹„ìœ¨ (%)', data: sorted.map(b => b.basicRatio), borderColor: '#34d399', backgroundColor: '#34d39922', fill: true, tension: 0.3, pointRadius: 4 },
        { label: 'íŒŒìƒì–´ ë¹„ìœ¨ (%)', data: sorted.map(b => b.morphComplex), borderColor: '#f472b6', backgroundColor: '#f472b622', fill: true, tension: 0.3, pointRadius: 4 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top', labels: { boxWidth: 12, padding: 8 } } },
      scales: {
        x: { ticks: { maxRotation: 45, font: { size: 9 } } },
        y: { beginAtZero: true, max: 60 }
      }
    }
  });
}

// Heatmap
let currentBook = null;
let lessonChart = null;

function renderBookTabs() {
  const container = document.getElementById('bookTabs');
  const allBooks = [...new Set(LESSON_RAW.map(l => l.book))];
  
  allBooks.forEach((book, i) => {
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (i === 0 ? ' active' : '');
    btn.textContent = shortName(book);
    btn.onclick = () => selectBook(book, btn);
    container.appendChild(btn);
  });
  
  selectBook(allBooks[0], container.querySelector('.tab-btn'));
}

function selectBook(bookName, btn) {
  currentBook = bookName;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderHeatmap(bookName);
  renderLessonChart(bookName);
}

function renderHeatmap(bookName) {
  const lessons = LESSON_RAW.filter(l => l.book === bookName);
  const container = document.getElementById('heatmapContainer');
  
  let html = '<div class="lesson-grid">';
  lessons.forEach(l => {
    const color = getGradeColorHex(l.avg);
    const alpha = Math.min(0.3 + (l.avg / 70) * 0.7, 1);
    html += `<div class="lesson-cell" style="background:${color}${Math.round(alpha*255).toString(16).padStart(2,'0')}; color:white"
      title="${l.lesson}: ë‚œì´ë„ ${l.avg}">
      <div class="lesson-num">${l.lesson.replace('Lesson ','L').replace('Day ','D').replace('DAY ','D')}</div>
      <div class="lesson-score">${l.avg}</div>
    </div>`;
  });
  html += '</div>';
  container.innerHTML = html;
}

function renderLessonChart(bookName) {
  const lessons = LESSON_RAW.filter(l => l.book === bookName);
  const labels = lessons.map(l => l.lesson.replace('Lesson ','L').replace('Day ','D').replace('DAY ','D'));
  const data = lessons.map(l => l.avg);
  const colors = lessons.map(l => getGradeColorHex(l.avg));
  
  document.getElementById('lessonChartTitle').textContent = `${bookName} â€” ë ˆìŠ¨ë³„ ë‚œì´ë„ ì¶”ì´`;
  
  if (lessonChart) lessonChart.destroy();
  
  const avg = data.reduce((s,v) => s+v, 0) / data.length;
  
  lessonChart = new Chart(document.getElementById('chartLessons'), {
    type: 'bar',
    data: {
      labels,
      datasets: [
        {
          type: 'bar',
          data,
          backgroundColor: colors.map(c => c + '88'),
          borderColor: colors,
          borderWidth: 1,
          borderRadius: 3,
          order: 2
        },
        {
          type: 'line',
          label: 'í‰ê· ',
          data: Array(data.length).fill(avg),
          borderColor: '#94a3b8',
          borderDash: [5, 5],
          borderWidth: 1.5,
          pointRadius: 0,
          order: 1
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: ctx => ctx.datasetIndex === 0 ? `ë‚œì´ë„: ${ctx.parsed.y} (${getGradeLabel(ctx.parsed.y)})` : `êµì¬ í‰ê· : ${avg.toFixed(1)}`
          }
        }
      },
      scales: {
        x: { ticks: { font: { size: 9 } } },
        y: { beginAtZero: true, max: 70, title: { display: true, text: 'ë‚œì´ë„ ì ìˆ˜' } }
      }
    }
  });
}

// Insights
function renderInsights() {
  const sorted = [...DATA.books].sort((a,b) => a.avgDifficulty - b.avgDifficulty);
  const text = `
    <strong>ë‚œì´ë„ ë¶„ì„ ê¸°ì¤€:</strong> ë‹¨ì–´ ê¸¸ì´(30%), ìŒì ˆ ìˆ˜(25%), ê¸°ì´ˆ ì–´íœ˜ ì—¬ë¶€(25%), í˜•íƒœì†Œ ë³µì¡ë„(20%)ë¥¼ ì¢…í•©í•œ 0~100ì  ìŠ¤ì¼€ì¼ì…ë‹ˆë‹¤.<br><br>
    <strong>ê¸°ë³¸ ì‹œë¦¬ì¦ˆ(01~10ê¶Œ):</strong> 1ê¶Œ(26.6ì , ì´ˆê¸‰)ì—ì„œ 10ê¶Œ(53.2ì , ì¤‘ìƒê¸‰)ê¹Œì§€ ì²´ê³„ì ìœ¼ë¡œ ë‚œì´ë„ê°€ ìƒìŠ¹í•©ë‹ˆë‹¤. 
    1~3ê¶Œì€ ê¸°ì´ˆ ì–´íœ˜ ë¹„ìœ¨ì´ 42~57%ë¡œ ë†’ì•„ ì…ë¬¸ìì—ê²Œ ì í•©í•˜ê³ , 8~10ê¶Œì€ ê¸°ì´ˆ ì–´íœ˜ê°€ 10% ë‚´ì™¸ë¡œ ë–¨ì–´ì§€ë©° ê³ ê¸‰ ìˆ˜ì¤€ì— ë„ë‹¬í•©ë‹ˆë‹¤. 
    ë‹¤ë§Œ 7ê¶Œ(44.6ì )ì´ 4ê¶Œ(44.6ì )ê³¼ ë¹„ìŠ·í•œ ìˆ˜ì¤€ìœ¼ë¡œ ë‚œì´ë„ ìˆœì„œê°€ ì™„ë²½í•˜ê²Œ ì„ í˜•ì ì´ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.<br><br>
    <strong>ìˆ˜ëŠ¥ ê¸°ì¶œ ì‹œë¦¬ì¦ˆ(01~05ê¶Œ):</strong> 1ê¶Œ(46.7ì )ë¶€í„° ì´ë¯¸ ê¸°ë³¸ ì‹œë¦¬ì¦ˆ 5~6ê¶Œ ìˆ˜ì¤€ì´ë©°, 3ê¶Œ(55.2ì )ì´ ê°€ì¥ ì–´ë µìŠµë‹ˆë‹¤. 
    íŠ¹íˆ ìˆ˜ëŠ¥ ê¸°ì¶œ 3~5ê¶Œì€ ê¸°ì´ˆ ì–´íœ˜ ë¹„ìœ¨ì´ 0~2%ì— ë¶ˆê³¼í•´ ê±°ì˜ ëª¨ë“  ë‹¨ì–´ê°€ ê³ ê¸‰ ì–´íœ˜ì…ë‹ˆë‹¤. 
    íŒŒìƒì–´(ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬) ë¹„ìœ¨ë„ 31~43%ë¡œ ê¸°ë³¸ ì‹œë¦¬ì¦ˆ(9~36%)ë³´ë‹¤ ë†’ì•„ í˜•íƒœì†Œ ë¶„ì„ ëŠ¥ë ¥ì´ ìš”êµ¬ë©ë‹ˆë‹¤.<br><br>
    <strong>ë ˆìŠ¨ ê°„ í¸ì°¨:</strong> ê°™ì€ êµì¬ ë‚´ì—ì„œë„ ë ˆìŠ¨ë³„ ë‚œì´ë„ ì°¨ì´ê°€ í¬ë©°(ìµœëŒ€ Â±15ì ), 
    ì´ëŠ” ì£¼ì œë³„ë¡œ ì–´íœ˜ ë‚œì´ë„ê°€ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  `;
  document.getElementById('insightText').innerHTML = text;
}

// Init
renderStats();
renderRankTable();
renderCharts();
renderBookTabs();
renderInsights();
</script>
</body>
</html>
